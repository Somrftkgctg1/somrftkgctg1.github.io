<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>somr сайт</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96c93d);
            background-size: 400%;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            animation: colorShift 15s ease infinite;
            transition: background 0.5s;
        }

        @keyframes colorShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .dark-theme {
            background: #222;
            animation: none;
        }

        .retro-theme {
            background: #1a1a1a;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%239C92AC' fill-opacity='0.4' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E");
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 600px;
            width: 100%;
            transition: background 0.5s, color 0.5s;
            position: relative;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .dark-theme .container {
            background: rgba(30, 30, 30, 0.95);
            color: #f5f5f5;
        }

        .retro-theme .container {
            background: #f0f0d8;
            color: #2e2e2e;
            border: 4px solid #000;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        h1 {
            color: #222;
            margin-bottom: 25px;
            font-size: 1.8em;
            transition: color 0.5s;
        }

        .dark-theme h1, .retro-theme h1 {
            color: #f5f5f5;
        }

        .retro-theme h1 {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
            text-shadow: 2px 2px #000;
        }

        .widget {
            margin: 20px 0;
            overflow: hidden;
            border-radius: 10px;
            position: relative;
            transition: transform 0.3s;
        }

        .widget:hover {
            transform: scale(1.02);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #eee;
            margin: 5px;
            border-radius: 5px;
            transition: background 0.3s, color 0.3s, transform 0.2s;
        }

        .tab:hover {
            transform: scale(1.05);
            background: #ddd;
        }

        .tab.active {
            background: #ff4d4d;
            color: white;
        }

        .dark-theme .tab {
            background: #444;
            color: #f5f5f5;
        }

        .dark-theme .tab:hover {
            background: #555;
        }

        .dark-theme .tab.active {
            background: #4ecdc4;
        }

        .retro-theme .tab {
            background: #d0d0a0;
            color: #000;
            font-family: 'Courier New', Courier, monospace;
            border: 2px solid #000;
        }

        .retro-theme .tab:hover {
            background: #c0c090;
        }

        .retro-theme .tab.active {
            background: #ff0000;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .joke {
            font-size: 1.1em;
            margin: 20px 0;
            color: #333;
        }

        .dark-theme .joke {
            color: #f5f5f5;
        }

        .retro-theme .joke {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
        }

        .joke-button {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            transition: background 0.3s, transform 0.2s;
        }

        .joke-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .joke-button {
            background: #4ecdc4;
        }

        .dark-theme .joke-button:hover {
            background: #3db8b0;
        }

        .retro-theme .joke-button {
            background: #ff0000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .retro-theme .joke-button:hover {
            background: #cc0000;
        }

        .theme-selector {
            margin-top: 20px;
        }

        .theme-selector label {
            margin-right: 10px;
            font-size: 1em;
        }

        .theme-selector select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .dark-theme .theme-selector select {
            background: #333;
            color: #f5f5f5;
            border-color: #555;
        }

        .retro-theme .theme-selector select {
            background: #d0d0a0;
            color: #000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .theme-selector select:focus {
            border-color: #ff4d4d;
            outline: none;
        }

        .popular-videos {
            display: flex;
            flex-direction: row;
            gap: 20px;
            overflow-x: auto;
            padding: 10px;
            white-space: nowrap;
        }

        .popular-video {
            border-radius: 10px;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            flex: 0 0 auto;
            width: 200px;
            opacity: 0;
            transform: translateX(-50px);
        }

        .tab-content.active .popular-video {
            animation: slideIn 0.5s ease forwards;
            animation-delay: calc(var(--index) * 0.1s);
        }

        @keyframes slideIn {
            0% { opacity: 0; transform: translateX(-50px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .dark-theme .popular-video {
            background: #333;
        }

        .retro-theme .popular-video {
            background: #f0f0d8;
            border: 2px solid #000;
        }

        .popular-video:hover {
            transform: scale(1.02);
        }

        .popular-video iframe {
            width: 100%;
            height: 112px;
        }

        .popular-video-title {
            font-size: 0.9em;
            margin: 10px;
            color: #333;
            text-align: left;
            white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .dark-theme .popular-video-title {
            color: #f5f5f5;
        }

        .retro-theme .popular-video-title {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
        }

        .youtube-button {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: #ff4d4d;
            padding: 10px;
            border-radius: 5px;
            text-decoration: none;
            transition: background 0.3s, transform 0.2s;
        }

        .youtube-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .youtube-button {
            background: #4ecdc4;
        }

        .dark-theme .youtube-button:hover {
            background: #3db8b0;
        }

        .retro-theme .youtube-button {
            background: #ff0000;
            border: 2px solid #000;
        }

        .retro-theme .youtube-button:hover {
            background: #cc0000;
        }

        .youtube-icon {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 400px;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
        }

        .dark-theme .chat-messages {
            background: #2a2a2a;
        }

        .retro-theme .chat-messages {
            background: #d0d0a0;
            border: 2px solid #000;
        }

        .message {
            margin: 10px;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
            word-wrap: break-word;
        }

        .message.sent {
            background: #ff4d4d;
            color: white;
            margin-left: auto;
        }

        .dark-theme .message.sent {
            background: #4ecdc4;
        }

        .retro-theme .message.sent {
            background: #ff0000;
            border: 2px solid #000;
        }

        .message.received {
            background: #e0e0e0;
            color: #333;
            margin-right: auto;
        }

        .dark-theme .message.received {
            background: #444;
            color: #f5f5f5;
        }

        .retro-theme .message.received {
            background: #f0f0d8;
            color: #2e2e2e;
            border: 2px solid #000;
        }

        .message .sender {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chat-input-container {
            display: flex;
            padding: 10px;
            background: #fff;
        }

        .dark-theme .chat-input-container {
            background: #333;
        }

        .retro-theme .chat-input-container {
            background: #d0d0a0;
            border-top: 2px solid #000;
        }

        .chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        .dark-theme .chat-input {
            background: #444;
            color: #f5f5f5;
            border-color: #555;
        }

        .retro-theme .chat-input {
            background: #f0f0d8;
            color: #2e2e2e;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .chat-input:focus {
            outline: none;
            border-color: #ff4d4d;
        }

        .chat-send-button {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            transition: background 0.3s, transform 0.2s;
        }

        .dark-theme .chat-send-button {
            background: #4ecdc4;
        }

        .retro-theme .chat-send-button {
            background: #ff0000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .chat-send-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .chat-send-button:hover {
            background: #3db8b0;
        }

        .retro-theme .chat-send-button:hover {
            background: #cc0000;
        }

        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .code-input, .nickname-input, .password-input, .confirm-password-input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            width: 200px;
            margin-bottom: 10px;
        }

        .dark-theme .code-input, .dark-theme .nickname-input, .dark-theme .password-input, .dark-theme .confirm-password-input {
            background: #444;
            color: #f5f5f5;
            border-color: #555;
        }

        .retro-theme .code-input, .retro-theme .nickname-input, .retro-theme .password-input, .retro-theme .confirm-password-input {
            background: #f0f0d8;
            color: #2e2e2e;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .code-input:focus, .nickname-input:focus, .password-input:focus, .confirm-password-input:focus {
            outline: none;
            border-color: #ff4d4d;
        }

        .code-submit-button, .register-button {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin: 5px;
        }

        .dark-theme .code-submit-button, .dark-theme .register-button {
            background: #4ecdc4;
        }

        .retro-theme .code-submit-button, .retro-theme .register-button {
            background: #ff0000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .code-submit-button:hover, .register-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .code-submit-button:hover, .dark-theme .register-button:hover {
            background: #3db8b0;
        }

        .retro-theme .code-submit-button:hover, .retro-theme .register-button:hover {
            background: #cc0000;
        }

        .toggle-auth {
            color: #ff4d4d;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 10px;
        }

        .dark-theme .toggle-auth {
            color: #4ecdc4;
        }

        .retro-theme .toggle-auth {
            color: #ff0000;
            font-family: 'Courier New', Courier, monospace;
        }

        .auth-error {
            color: #ff4d4d;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .dark-theme .auth-error {
            color: #4ecdc4;
        }

        .retro-theme .auth-error {
            color: #ff0000;
            font-family: 'Courier New', Courier, monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Живой счетчик подписчиков YouTube и Чат</h1>
        <div class="tabs">
            <div class="tab active" onclick="showTab('counter')">Счетчик</div>
            <div class="tab" onclick="showTab('popular')">Популярные видео Арсен</div>
            <div class="tab" onclick="showTab('jokes')">Анекдоты</div>
            <div class="tab" onclick="showTab('login')">Войти</div>
            <div class="tab" onclick="showTab('chat')">Чат</div>
        </div>
        <div class="tab-content active" id="counter">
            <div class="widget">
                <iframe id="subscriberCounter" height="90px" width="310px" frameborder="0" src="https://socialcounts.org/youtube-live-subscriber-count/UCY02QF_DfOy2qChqWyi6Dfw/embed" allowFullScreen></iframe>
            </div>
        </div>
        <div class="tab-content" id="popular">
            <div class="widget">
                <iframe id="arsenCounter" height="90px" width="310px" frameborder="0" src="https://socialcounts.org/youtube-live-subscriber-count/UCuOuEsj6-EiykBf4PtSWtdQ/embed" allowFullScreen></iframe>
            </div>
            <div class="popular-videos">
                <div class="popular-video" style="--index: 0;">
                    <iframe width="200" height="112" src="https://www.youtube.com/embed/eouCQ-Gbx4U" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="popular-video-title">Учу готовить яйца часть 1</div>
                </div>
                <div class="popular-video" style="--index: 1;">
                    <iframe width="200" height="112" src="https://www.youtube.com/embed/FAWQ0OUH7Is" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="popular-video-title">Обзор на игры часть 1</div>
                </div>
                <div class="popular-video" style="--index: 2;">
                    <iframe width="200" height="112" src="https://www.youtube.com/embed/EUBLUz3rV3k?start=1043" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="popular-video-title">Играю в пыльную поездку</div>
                </div>
            </div>
        </div>
        <div class="tab-content" id="jokes">
            <div class="joke" id="joke"></div>
            <button class="joke-button" onclick="generateJoke()">Сгенерировать анекдот</button>
        </div>
        <div class="tab-content" id="login">
            <div class="auth-container">
                <div id="loginForm">
                    <input type="text" class="nickname-input" id="loginNicknameInput" placeholder="Введите ник (1-20 символов)">
                    <input type="password" class="password-input" id="loginPasswordInput" placeholder="Введите пароль">
                    <button class="code-submit-button" onclick="submitLogin()">Войти</button>
                    <div class="toggle-auth" onclick="toggleAuthForm()">Нет аккаунта? Зарегистрируйтесь</div>
                </div>
                <div id="registerForm" style="display: none;">
                    <input type="text" class="nickname-input" id="registerNicknameInput" placeholder="Введите ник (1-20 символов)">
                    <input type="password" class="password-input" id="registerPasswordInput" placeholder="Введите пароль (6-50 символов)">
                    <input type="password" class="confirm-password-input" id="confirmPasswordInput" placeholder="Подтвердите пароль">
                    <button class="register-button" onclick="submitRegister()">Зарегистрироваться</button>
                    <div class="toggle-auth" onclick="toggleAuthForm()">Уже есть аккаунт? Войдите</div>
                </div>
                <div class="auth-error" id="authError"></div>
            </div>
        </div>
        <div class="tab-content" id="chat">
            <div id="codeEntry" class="auth-container" style="display: none;">
                <input type="text" class="code-input" id="codeInput" placeholder="Введите код (например, 123456)">
                <button class="code-submit-button" onclick="submitCode()">Подключиться</button>
                <div class="auth-error" id="codeError"></div>
            </div>
            <div id="chatContainer" class="chat-container" style="display: none;">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Введите сообщение...">
                    <button class="chat-send-button" onclick="sendMessage()">Отправить</button>
                </div>
            </div>
        </div>
        <div class="theme-selector">
            <label for="theme">Выберите тему:</label>
            <select id="theme" onchange="changeTheme()">
                <option value="light">Светлая</option>
                <option value="dark">Темная</option>
                <option value="retro">Ретро</option>
            </select>
        </div>
        <a href="https://www.youtube.com/channel/UCY02QF_DfOy2qChqWyi6Dfw" target="_blank" class="youtube-button">
            <svg class="youtube-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M23.5 6.2c-.3-1.1-1.2-2-2.3-2.3C19.1 3.5 12 3.5 12 3.5s-7.1 0-9.2.4c-1.1.3-2 1.2-2.3 2.3C.1 8.3 0 11.2 0 12s0 3.7.4 5.8c.3 1.1 1.2 2 2.3 2.3 2.1.4 9.2.4 9.2.4s7.1 0 9.2-.4c1.1-.3 2-1.2 2.3-2.3.4-2.1.4-5 .4-5.8s0-3.7-.4-5.8zM9.6 16.3V7.7l6.1 4.3-6.1 4.3z"/>
            </svg>
        </a>
    </div>

    <script>
        let ws = null;
        let isChatUnlocked = false;
        let currentUser = null;
        let chatCode = null;

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');

            if (tabId === 'counter') {
                const iframe = document.getElementById('subscriberCounter');
                const baseSrc = 'https://socialcounts.org/youtube-live-subscriber-count/UCY02QF_DfOy2qChqWyi6Dfw/embed';
                iframe.src = baseSrc + '?t=' + new Date().getTime();
            } else if (tabId === 'popular') {
                const iframe = document.getElementById('arsenCounter');
                const baseSrc = 'https://socialcounts.org/youtube-live-subscriber-count/UCuOuEsj6-EiykBf4PtSWtdQ/embed';
                iframe.src = baseSrc + '?t=' + new Date().getTime();
            } else if (tabId === 'chat' && currentUser && !isChatUnlocked) {
                document.getElementById('codeEntry').style.display = 'block';
                document.getElementById('chatContainer').style.display = 'none';
            } else if (tabId === 'chat' && isChatUnlocked) {
                document.getElementById('codeEntry').style.display = 'none';
                document.getElementById('chatContainer').style.display = 'flex';
                scrollToBottom();
            }
        }

        function changeTheme() {
            const theme = document.getElementById('theme').value;
            document.body.className = '';
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            } else if (theme === 'retro') {
                document.body.classList.add('retro-theme');
            }
        }

        const jokes = [
            "Журналист спрашивает: — Господин Трамп, как прошли переговоры с Путиным? — Отлично! Мы договорились, что Аляска пока остаётся у США.",
            "Моя девушка била меня по лицу, когда испытывала оргазм. Я не особо переживал, пока не узнал, что она притворяется.",
            "Если Трамп приведет на встречу на Аляске Зеленского, то Путину надо привести с собой Ким Чен Ына - чувак тоже вовлечен в конфликт. Вот это будет встреча!",
            "Почти каждый из нас ценит человеческую жизнь выше жизни рыбы, но мало кто ценит одну человеческую жизнь выше жизней всех рыб на планете. А это означает, что у каждого человека есть определённое количество рыбы, которое он предпочёл бы оставить в живых вместо Лёхи с работы.",
            "Макрон заявил о создании коалиции желающих поехать на Аляску.",
            "Я случайно стал незаменимым человеком на работе, и вот теперь мне точно песец.",
            "- Что делаешь? - Сижу в стратегической задумчивости. - Тупишь? - Да.",
            "Ибо сказано в писании: Первый кабачок съешь сам, Второй отдай родственнику, Третий перекинь через забор соседу, пусть порадуется.",
            "Нравится мне эта новая технология, - оплата улыбкой! Я вот только не знаю: если меня гаишники на дороге останавливают, я могу расплатиться улыбкой, или там эта опция ещё не работает?",
            "Идет посадка на рейс авиакомпании \"Победа\". Внезапно в очереди появляется пингвин, который держит в клюве двух мертвых кроликов. Сотрудник \"Победы\": - Да вы с ума сошли?! У нас в ручной клади разрешено провозить только одного мертвого кролика!",
            "Игральные карты говорят, что мне не повезёт в любви. А банковские карты - наоборот. Чему верить?",
            "Хорошо, что есть другие точки зрения. Если бы не они, я бы не знал, что я умный.",
            "Преддверие курортного сезона. Мэр со свитой обходят местный пляж. Слева - море, справа - отгораживающие бетонные плиты. На плитах - гигантские надписи, мэр их внимательно читает. - «Scorpions forever». Понятно… Идут дальше. - «Серый - не козел». Понятно… Идут дальше. - «Позор средневековым тряпкам!» Не понял… Свита: - Ефрем Ефремович, мы зашли на так называемый нудистский пляж.",
            "- Кать, тебя отпустило? - Куда? - ПОНЯТНО...",
            "Регулярно ныряя в кайф с теплой, сладкой водичкой под названием \"любвь к себе\", легко захлебнуться и утонуть."
        ];

        function generateJoke() {
            const jokeElement = document.getElementById('joke');
            const randomIndex = Math.floor(Math.random() * jokes.length);
            jokeElement.textContent = jokes[randomIndex];
        }

        // WebSocket setup
        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8080'); // Замените на ваш WebSocket URL в продакшене

            ws.onopen = () => {
                console.log('WebSocket connected');
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'error') {
                    document.getElementById('authError').textContent = data.message;
                } else if (data.type === 'register_success' || data.type === 'login_success') {
                    currentUser = data.nickname;
                    showTab('chat');
                    document.getElementById('codeEntry').style.display = 'block';
                    document.getElementById('chatContainer').style.display = 'none';
                } else if (data.type === 'messages') {
                    renderMessages(data.messages);
                }
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                setTimeout(connectWebSocket, 5000); // Reconnect after 5 seconds
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }

        // Toggle between login and register forms
        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
            document.getElementById('authError').textContent = '';
        }

        // Register user
        function submitRegister() {
            const nicknameInput = document.getElementById('registerNicknameInput').value.trim();
            const passwordInput = document.getElementById('registerPasswordInput').value.trim();
            const confirmPasswordInput = document.getElementById('confirmPasswordInput').value.trim();
            const authError = document.getElementById('authError');

            if (!nicknameInput || nicknameInput.length < 1 || nicknameInput.length > 20) {
                authError.textContent = "Ник должен быть от 1 до 20 символов.";
                return;
            }
            if (passwordInput.length < 6 || passwordInput.length > 50) {
                authError.textContent = "Пароль должен быть от 6 до 50 символов.";
                return;
            }
            if (passwordInput !== confirmPasswordInput) {
                authError.textContent = "Пароли не совпадают.";
                return;
            }

            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'register', nickname: nicknameInput, password: passwordInput }));
            } else {
                authError.textContent = "Нет соединения с сервером.";
            }
        }

        // Login user
        function submitLogin() {
            const nicknameInput = document.getElementById('loginNicknameInput').value.trim();
            const passwordInput = document.getElementById('loginPasswordInput').value.trim();
            const authError = document.getElementById('authError');

            if (!nicknameInput || nicknameInput.length < 1 || nicknameInput.length > 20) {
                authError.textContent = "Ник должен быть от 1 до 20 символов.";
                return;
            }

            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'login', nickname: nicknameInput, password: passwordInput }));
            } else {
                authError.textContent = "Нет соединения с сервером.";
            }
        }

        // Join chat with code
        function submitCode() {
            const codeInput = document.getElementById('codeInput').value.trim();
            const codeError = document.getElementById('codeError');

            if (codeInput !== '123456') {
                codeError.textContent = "Неверный код. Попробуйте снова.";
                return;
            }

            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'join', chatCode: codeInput, nickname: currentUser }));
                isChatUnlocked = true;
                chatCode = codeInput;
                document.getElementById('codeEntry').style.display = 'none';
                document.getElementById('chatContainer').style.display = 'flex';
            } else {
                codeError.textContent = "Нет соединения с сервером.";
            }
        }

        // Render messages
        function renderMessages(messages) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', message.user === currentUser ? 'sent' : 'received');
                const senderElement = document.createElement('div');
                senderElement.classList.add('sender');
                senderElement.textContent = message.user;
                messageElement.appendChild(senderElement);
                const textElement = document.createElement('div');
                textElement.textContent = message.text;
                messageElement.appendChild(textElement);
                chatMessages.appendChild(messageElement);
            });
            scrollToBottom();
        }

        // Send message
        function sendMessage() {
            if (!isChatUnlocked) return;
            const chatInput = document.getElementById('chatInput');
            const text = chatInput.value.trim();
            if (text && ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'message', chatCode, nickname: currentUser, text }));
                chatInput.value = '';
            }
        }

        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Handle Enter key for inputs
        document.getElementById('loginNicknameInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitLogin();
        });
        document.getElementById('loginPasswordInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitLogin();
        });
        document.getElementById('registerNicknameInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitRegister();
        });
        document.getElementById('registerPasswordInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitRegister();
        });
        document.getElementById('confirmPasswordInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitRegister();
        });
        document.getElementById('codeInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitCode();
        });
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        // Initialize
        window.onload = function() {
            connectWebSocket();
            generateJoke();
        };
    </script>
</body>
</html>
