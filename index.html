<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>somr сайт</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96c93d);
            background-size: 400%;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            animation: colorShift 15s ease infinite;
            transition: background 0.5s;
        }

        @keyframes colorShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .dark-theme {
            background: #222;
            animation: none;
        }

        .retro-theme {
            background: #1a1a1a;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%239C92AC' fill-opacity='0.4' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E");
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 1000px;
            width: 100%;
            transition: background 0.5s, color 0.5s;
            position: relative;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .dark-theme .container {
            background: rgba(30, 30, 30, 0.95);
            color: #f5f5f5;
        }

        .retro-theme .container {
            background: #f0f0d8;
            color: #2e2e2e;
            border: 4px solid #000;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        h1, h2 {
            color: #222;
            margin-bottom: 25px;
            font-size: 1.8em;
            transition: color 0.5s;
        }

        .dark-theme h1, .dark-theme h2 {
            color: #f5f5f5;
        }

        .retro-theme h1, .retro-theme h2 {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
            text-shadow: 2px 2px #000;
        }

        .widget {
            margin: 20px 0;
            overflow: hidden;
            border-radius: 10px;
            position: relative;
            transition: transform 0.3s;
        }

        .widget:hover {
            transform: scale(1.02);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #eee;
            margin: 5px;
            border-radius: 5px;
            transition: background 0.3s, color 0.3s, transform 0.2s;
        }

        .tab:hover {
            transform: scale(1.05);
            background: #ddd;
        }

        .tab.active {
            background: #ff4d4d;
            color: white;
        }

        .dark-theme .tab {
            background: #444;
            color: #f5f5f5;
        }

        .dark-theme .tab:hover {
            background: #555;
        }

        .dark-theme .tab.active {
            background: #4ecdc4;
        }

        .retro-theme .tab {
            background: #d0d0a0;
            color: #000;
            font-family: 'Courier New', Courier, monospace;
            border: 2px solid #000;
        }

        .retro-theme .tab:hover {
            background: #c0c090;
        }

        .retro-theme .tab.active {
            background: #ff0000;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .joke {
            font-size: 1.1em;
            margin: 20px 0;
            color: #333;
        }

        .dark-theme .joke {
            color: #f5f5f5;
        }

        .retro-theme .joke {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
        }

        .joke-button {
            background: #ff4d4d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            transition: background 0.3s, transform 0.2s;
        }

        .joke-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .joke-button {
            background: #4ecdc4;
        }

        .dark-theme .joke-button:hover {
            background: #3db8b0;
        }

        .retro-theme .joke-button {
            background: #ff0000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .retro-theme .joke-button:hover {
            background: #cc0000;
        }

        .theme-selector {
            margin-top: 20px;
        }

        .theme-selector label {
            margin-right: 10px;
            font-size: 1em;
        }

        .theme-selector select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .dark-theme .theme-selector select {
            background: #333;
            color: #f5f5f5;
            border-color: #555;
        }

        .retro-theme .theme-selector select {
            background: #d0d0a0;
            color: #000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .theme-selector select:focus {
            border-color: #ff4d4d;
            outline: none;
        }

        .popular-videos {
            display: flex;
            flex-direction: row;
            gap: 20px;
            overflow-x: auto;
            padding: 10px;
            white-space: nowrap;
        }

        .popular-video {
            border-radius: 10px;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            flex: 0 0 auto;
            width: 200px;
            opacity: 0;
            transform: translateX(-50px);
        }

        .tab-content.active .popular-video {
            animation: slideIn 0.5s ease forwards;
            animation-delay: calc(var(--index) * 0.1s);
        }

        @keyframes slideIn {
            0% { opacity: 0; transform: translateX(-50px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .dark-theme .popular-video {
            background: #333;
        }

        .retro-theme .popular-video {
            background: #f0f0d8;
            border: 2px solid #000;
        }

        .popular-video:hover {
            transform: scale(1.02);
        }

        .popular-video iframe {
            width: 100%;
            height: 112px;
        }

        .popular-video-title {
            font-size: 0.9em;
            margin: 10px;
            color: #333;
            text-align: left;
            white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .dark-theme .popular-video-title {
            color: #f5f5f5;
        }

        .retro-theme .popular-video-title {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
        }

        .youtube-button {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: #ff4d4d;
            padding: 10px;
            border-radius: 5px;
            text-decoration: none;
            transition: background 0.3s, transform 0.2s;
        }

        .youtube-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .youtube-button {
            background: #4ecdc4;
        }

        .dark-theme .youtube-button:hover {
            background: #3db8b0;
        }

        .retro-theme .youtube-button {
            background: #ff0000;
            border: 2px solid #000;
        }

        .retro-theme .youtube-button:hover {
            background: #cc0000;
        }

        .youtube-icon {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .chat-iframe {
            width: 100%;
            height: 1000px;
            border: none;
            border-radius: 10px;
        }

        .dark-theme .chat-iframe {
            background: #333;
        }

        .retro-theme .chat-iframe {
            background: #f0f0d8;
            border: 2px solid #000;
        }

        .auth-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: transparent;
            color: #333;
            transition: border-color 0.3s;
        }

        .dark-theme .input-group input {
            background: #444;
            color: #f5f5f5;
            border-color: #555;
        }

        .retro-theme .input-group input {
            background: #d0d0a0;
            color: #000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .input-group input:focus {
            border-color: #ff4d4d;
            outline: none;
        }

        .btn-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .auth-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #ff4d4d;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            flex: 1;
        }

        .auth-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .auth-button {
            background: #4ecdc4;
        }

        .dark-theme .auth-button:hover {
            background: #3db8b0;
        }

        .retro-theme .auth-button {
            background: #ff0000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .retro-theme .auth-button:hover {
            background: #cc0000;
        }

        .message {
            color: #333;
            text-align: center;
            margin-top: 20px;
        }

        .dark-theme .message {
            color: #f5f5f5;
        }

        .retro-theme .message {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
        }

        .toggle-link {
            color: #ff4d4d;
            cursor: pointer;
            text-align: center;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .dark-theme .toggle-link {
            color: #4ecdc4;
        }

        .retro-theme .toggle-link {
            color: #ff0000;
            font-family: 'Courier New', Courier, monospace;
        }

        .toggle-link:hover {
            text-decoration: underline;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #222;
            font-size: 0.9em;
        }

        .dark-theme .user-info {
            color: #f5f5f5;
        }

        .retro-theme .user-info {
            color: #2e2e2e;
            font-family: 'Courier New', Courier, monospace;
        }

        .logout-button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            background: #ff4d4d;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin-left: 10px;
        }

        .logout-button:hover {
            background: #e63939;
            transform: scale(1.05);
        }

        .dark-theme .logout-button {
            background: #4ecdc4;
        }

        .dark-theme .logout-button:hover {
            background: #3db8b0;
        }

        .retro-theme .logout-button {
            background: #ff0000;
            border: 2px solid #000;
            font-family: 'Courier New', Courier, monospace;
        }

        .retro-theme .logout-button:hover {
            background: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="user-info" id="user-info" style="display: none;">
            <span id="user-name"></span>
            <button class="logout-button" onclick="logout()">Выйти</button>
        </div>
        <h1>Живой счетчик подписчиков YouTube</h1>
        <div class="tabs">
            <div class="tab active" onclick="showTab('counter')">Счетчик</div>
            <div class="tab" onclick="showTab('popular')">Популярные видео Арсен</div>
            <div class="tab" onclick="showTab('jokes')">Анекдоты</div>
            <div class="tab" onclick="showTab('chat')">Чат</div>
            <div class="tab" onclick="showTab('auth')">Авторизация</div>
        </div>
        <div class="tab-content active" id="counter">
            <div class="widget">
                <iframe id="subscriberCounter" height="90px" width="310px" frameborder="0" src="https://socialcounts.org/youtube-live-subscriber-count/UCY02QF_DfOy2qChqWyi6Dfw/embed" allowFullScreen></iframe>
            </div>
        </div>
        <div class="tab-content" id="popular">
            <div class="widget">
                <iframe id="arsenCounter" height="90px" width="310px" frameborder="0" src="https://socialcounts.org/youtube-live-subscriber-count/UCuOuEsj6-EiykBf4PtSWtdQ/embed" allowFullScreen></iframe>
            </div>
            <div class="popular-videos">
                <div class="popular-video" style="--index: 0;">
                    <iframe width="200" height="112" src="https://www.youtube.com/embed/eouCQ-Gbx4U" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="popular-video-title">Учу готовить яйца часть 1</div>
                </div>
                <div class="popular-video" style="--index: 1;">
                    <iframe width="200" height="112" src="https://www.youtube.com/embed/FAWQ0OUH7Is" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="popular-video-title">Обзор на игры часть 1</div>
                </div>
                <div class="popular-video" style="--index: 2;">
                    <iframe width="200" height="112" src="https://www.youtube.com/embed/EUBLUz3rV3k?start=1043" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="popular-video-title">Играю в пыльную поездку</div>
                </div>
            </div>
        </div>
        <div class="tab-content" id="jokes">
            <div class="joke" id="joke"></div>
            <button class="joke-button" onclick="generateJoke()">Сгенерировать анекдот</button>
        </div>
        <div class="tab-content" id="chat">
            <div class="widget">
                <iframe class="chat-iframe" id="chatIframe" src="chat.html"></iframe>
            </div>
        </div>
        <div class="tab-content" id="auth">
            <div class="auth-container">
                <h2 id="auth-title">Вход</h2>
                <div class="input-group">
                    <input type="text" id="first-name" placeholder="Никнейм" style="display: none;">
                </div>
                <div class="input-group">
                    <input type="email" id="email" placeholder="Email">
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="Пароль">
                </div>
                <div class="input-group" id="confirm-password-group" style="display: none;">
                    <input type="password" id="confirm-password" placeholder="Подтвердите пароль">
                </div>
                <div class="btn-group">
                    <button class="auth-button" onclick="handleAuth()">Войти</button>
                </div>
                <p class="toggle-link" onclick="toggleAuthMode()">Нет аккаунта? Зарегистрируйтесь</p>
                <p class="message" id="auth-message"></p>
            </div>
        </div>
        <div class="theme-selector">
            <label for="theme">Выберите тему:</label>
            <select id="theme" onchange="changeTheme()">
                <option value="light">Светлая</option>
                <option value="dark">Темная</option>
                <option value="retro">Ретро</option>
            </select>
        </div>
        <a href="https://www.youtube.com/channel/UCY02QF_DfOy2qChqWyi6Dfw" target="_blank" class="youtube-button">
            <svg class="youtube-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M23.5 6.2c-.3-1.1-1.2-2-2.3-2.3C19.1 3.5 12 3.5 12 3.5s-7.1 0-9.2.4c-1.1.3-2 1.2-2.3 2.3C.1 8.3 0 11.2 0 12s0 3.7.4 5.8c.3 1.1 1.2 2 2.3 2.3 2.1.4 9.2.4 9.2.4s7.1 0 9.2-.4c1.1-.3 2-1.2 2.3-2.3.4-2.1.4-5 .4-5.8s0-3.7-.4-5.8zM9.6 16.3V7.7l6.1 4.3-6.1 4.3z"/>
            </svg>
        </a>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBDRXruhsAKhoSrshRTbL-v15wTLWYH-Ao",
            authDomain: "webgramoteykin.firebaseapp.com",
            databaseURL: "https://sitesomr-default-rtdb.firebaseio.com/",
            projectId: "webgramoteykin",
            storageBucket: "webgramoteykin.appspot.com",
            messagingSenderId: "402173829627",
            appId: "1:402173829627:web:cc2117b2682c4e1a122b5e",
            measurementId: "G-FZVVPD1SDR"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let isLoginMode = true;

        const jokes = [
            "Журналист спрашивает: — Господин Трамп, как прошли переговоры с Путиным? — Отлично! Мы договорились, что Аляска пока остаётся у США.",
            "Моя девушка била меня по лицу, когда испытывала оргазм. Я не особо переживал, пока не узнал, что она притворяется.",
            "Если Трамп приведет на встречу на Аляске Зеленского, то Путину надо привести с собой Ким Чен Ына - чувак тоже вовлечен в конфликт. Вот это будет встреча!",
            "Почти каждый из нас ценит человеческую жизнь выше жизни рыбы, но мало кто ценит одну человеческую жизнь выше жизней всех рыб на планете. А это означает, что у каждого человека есть определённое количество рыбы, которое он предпочёл бы оставить в живых вместо Лёхи с работы.",
            "Макрон заявил о создании коалиции желающих поехать на Аляску.",
            "Я случайно стал незаменимым человеком на работе, и вот теперь мне точно песец.",
            "- Что делаешь? - Сижу в стратегической задумчивости. - Тупишь? - Да.",
            "Ибо сказано в писании: Первый кабачок съешь сам, Второй отдай родственнику, Третий перекинь через забор соседу, пусть порадуется.",
            "Нравится мне эта новая технология, - оплата улыбкой! Я вот только не знаю: если меня гаишники на дороге останавливают, я могу расплатиться улыбкой, или там эта опция ещё не работает?",
            "Идет посадка на рейс авиакомпании \"Победа\". Внезапно в очереди появляется пингвин, который держит в клюве двух мертвых кроликов. Сотрудник \"Победы\": - Да вы с ума сошли?! У нас в ручной клади разрешено провозить только одного мертвого кролика!"
        ];

        function generateJoke() {
            const jokeElement = document.getElementById('joke');
            const randomIndex = Math.floor(Math.random() * jokes.length);
            jokeElement.textContent = jokes[randomIndex];
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-title').textContent = isLoginMode ? 'Вход' : 'Регистрация';
            document.getElementById('first-name').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('confirm-password-group').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('auth-button').textContent = isLoginMode ? 'Войти' : 'Зарегистрироваться';
            document.getElementById('toggle-link').textContent = isLoginMode ? 'Нет аккаунта? Зарегистрируйтесь' : 'Уже есть аккаунт? Войдите';
            document.getElementById('auth-message').textContent = '';
        }

        function showError(message) {
            const errorElement = document.getElementById('auth-message');
            errorElement.textContent = message;
            errorElement.classList.add('message');
        }

        function handleAuth() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const firstName = document.getElementById('first-name').value.trim();
            const confirmPassword = document.getElementById('confirm-password').value.trim();

            if (!email || !password || (!isLoginMode && !firstName)) {
                showError('Заполните все поля.');
                return;
            }

            if (!isLoginMode && password !== confirmPassword) {
                showError('Пароли не совпадают.');
                return;
            }

            if (isLoginMode) {
                auth.signInWithEmailAndPassword(email, password)
                    .then(userCredential => {
                        const uid = userCredential.user.uid;
                        document.getElementById('chatIframe').src = `chat.html?uid=${uid}&theme=${document.getElementById('theme').value}`;
                        showTab('chat');
                    })
                    .catch(error => {
                        let message = 'Ошибка авторизации.';
                        if (error.code === 'auth/invalid-email') {
                            message = 'Неверный формат email.';
                        } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                            message = 'Неверный email или пароль.';
                        }
                        showError(message);
                    });
            } else {
                auth.createUserWithEmailAndPassword(email, password)
                    .then(userCredential => {
                        const uid = userCredential.user.uid;
                        return db.collection('users').doc(uid).set({
                            firstName: firstName,
                            status: 'Пользователь',
                            statusOnline: true,
                            lastOnline: firebase.firestore.FieldValue.serverTimestamp()
                        }).then(() => {
                            document.getElementById('chatIframe').src = `chat.html?uid=${uid}&theme=${document.getElementById('theme').value}`;
                            showTab('chat');
                        });
                    })
                    .catch(error => {
                        let message = 'Ошибка регистрации.';
                        if (error.code === 'auth/email-already-in-use') {
                            message = 'Email уже используется.';
                        } else if (error.code === 'auth/invalid-email') {
                            message = 'Неверный формат email.';
                        } else if (error.code === 'auth/weak-password') {
                            message = 'Пароль слишком слабый (минимум 6 символов).';
                        }
                        showError(message);
                    });
            }
        }

        function logout() {
            auth.signOut().then(() => {
                document.getElementById('user-info').style.display = 'none';
                document.getElementById('chatIframe').src = `chat.html?theme=${document.getElementById('theme').value}`;
                showTab('auth');
            }).catch(error => {
                showError('Ошибка при выходе: ' + error.message);
            });
        }

        auth.onAuthStateChanged(user => {
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const chatIframe = document.getElementById('chatIframe');
            const theme = document.getElementById('theme').value;
            if (user) {
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists) {
                        userName.textContent = doc.data().firstName;
                        userInfo.style.display = 'block';
                        chatIframe.src = `chat.html?uid=${user.uid}&theme=${theme}`;
                    }
                }).catch(error => {
                    showError('Ошибка загрузки данных пользователя.');
                    auth.signOut();
                    chatIframe.src = `chat.html?theme=${theme}`;
                });
            } else {
                userInfo.style.display = 'none';
                chatIframe.src = `chat.html?theme=${theme}`;
            }
        });

        window.addEventListener('message', (event) => {
            if (event.data.getTheme) {
                const chatIframe = document.getElementById('chatIframe');
                chatIframe.contentWindow.postMessage({ theme: document.getElementById('theme').value }, '*');
            } else if (event.data.updateUsername) {
                document.getElementById('user-name').textContent = event.data.updateUsername;
            }
        });

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');

            const theme = document.getElementById('theme').value;
            if (tabId === 'counter') {
                const iframe = document.getElementById('subscriberCounter');
                const baseSrc = 'https://socialcounts.org/youtube-live-subscriber-count/UCY02QF_DfOy2qChqWyi6Dfw/embed';
                iframe.src = baseSrc + '?t=' + new Date().getTime();
            } else if (tabId === 'popular') {
                const iframe = document.getElementById('arsenCounter');
                const baseSrc = 'https://socialcounts.org/youtube-live-subscriber-count/UCuOuEsj6-EiykBf4PtSWtdQ/embed';
                iframe.src = baseSrc + '?t=' + new Date().getTime();
            } else if (tabId === 'chat' && !auth.currentUser) {
                showTab('auth');
                showError('Войдите, чтобы использовать чат.');
            } else if (tabId === 'chat') {
                const chatIframe = document.getElementById('chatIframe');
                chatIframe.src = auth.currentUser ? `chat.html?uid=${auth.currentUser.uid}&theme=${theme}` : `chat.html?theme=${theme}`;
            }
        }

        function changeTheme() {
            const theme = document.getElementById('theme').value;
            document.body.className = '';
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            } else if (theme === 'retro') {
                document.body.classList.add('retro-theme');
            }
            const chatIframe = document.getElementById('chatIframe');
            if (chatIframe.contentWindow) {
                chatIframe.contentWindow.postMessage({ theme: theme }, '*');
            }
        }

        window.onload = () => {
            generateJoke();
            const themeSelect = document.getElementById('theme');
            themeSelect.value = 'dark';
            document.body.classList.add('dark-theme');
            document.getElementById('chatIframe').src = `chat.html?theme=dark`;
        };
    </script>
</body>
</html>
